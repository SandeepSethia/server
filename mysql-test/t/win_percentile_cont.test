CREATE TABLE student (name CHAR(10), test double, score DECIMAL(19,4));
INSERT INTO student VALUES
('Chun', 0, 3), ('Chun', 0, 7),
('Kaolin', 0.5, 3), ('Kaolin', 0.6, 7),
('Kaolin', 0.5, 4),
('Tatiana', 0.8, 4), ('Tata', 0.8, 4);

#no partition clause
select name, percentile_disc(0.5) within group(order by score)  over ()  from student;
select name, percentile_cont(0.5) within group(order by score)  over ()  from student;

# argument set to null
select name, percentile_cont(null)  within group(order by score) over (partition by name) from student;
select name, percentile_disc(null)  within group(order by score) over (partition by name) from student;

# complete query with partition column
select name, percentile_cont(0.5)  within group(order by score) over (partition by name) as c from student;
select name, percentile_disc(0.5)  within group(order by score) over (partition by name) as c from student;

#subqueries having percentile functions

select * from ( select name , percentile_cont(0.5) within group ( order by score) over (partition by name ) from student ) as t;
select * from ( select name , percentile_disc(0.5) within group ( order by score) over (partition by name ) from student ) as t;
select name from student a where (select  percentile_disc(0.5) within group (order by score) over (partition by name) from student b limit 1) >= 0.5;

# WITH STORED PROCEDURES


#DISALLOWED FIELDS IN ORDER BY CLAUSE
--error ER_WRONG_TYPE_FOR_PERCENTILE_CONT
select score,  percentile_cont(0.5)  within group(order by name) over (partition by score) from student;
select score,  percentile_disc(0.5)  within group(order by name) over (partition by score) from student;

# error with 2 order by elements

--error ER_NOT_SINGLE_ELEMENT_ORDER_LIST
select percentile_disc(0.5) within group(order by score,test) over (partition by name) from student;
--error ER_NOT_SINGLE_ELEMENT_ORDER_LIST
select percentile_cont(0.5) within group(order by score,test) over (partition by name) from student;

#parameter value should be in the range of 0 to 1( NEED TO THINK A WAY FOR THIS)
--error ER_ARGUMENT_OUT_OF_RANGE
select percentile_disc(1.5) within group(order by score) over (partition by name) from student;
--error ER_ARGUMENT_OUT_OF_RANGE
select percentile_cont(1.5) within group(order by score) over (partition by name) from student;

--error ER_ARGUMENT_NOT_CONSTANT
select name,percentile_cont(test) within group(order by score) over (partition by name) from student;
--error ER_ARGUMENT_NOT_CONSTANT
select name, percentile_disc(test) within group(order by score) over (partition by name) from student;

#CHECK TYPE OF THE ARGUMENT, SHOULD BE ONLY NUMERICAL
#select name, percentile_cont(name) within group(order by score) over (partition by name) from student;

drop table student;
